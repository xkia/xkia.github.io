import{_ as a,c as i,o as n,ah as e}from"./chunks/framework.BwTf_eGd.js";const b=JSON.parse('{"title":"WireGuard配置方式","description":"","frontmatter":{"title":"WireGuard配置方式","layout":"doc"},"headers":[],"relativePath":"develop/WireGuard.md","filePath":"develop/WireGuard.md"}'),l={name:"develop/WireGuard.md"};function p(r,s,t,d,h,c){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="wireguard" tabindex="-1">WireGuard <a class="header-anchor" href="#wireguard" aria-label="Permalink to “WireGuard”">​</a></h1><h2 id="有公网ip" tabindex="-1">有公网IP <a class="header-anchor" href="#有公网ip" aria-label="Permalink to “有公网IP”">​</a></h2><h2 id="无公网ip" tabindex="-1">无公网IP <a class="header-anchor" href="#无公网ip" aria-label="Permalink to “无公网IP”">​</a></h2><blockquote><p>在无公网IP的情况下，则需要通过云服务器作为中转服务器，进行中转</p></blockquote><h3 id="架构" tabindex="-1">架构 <a class="header-anchor" href="#架构" aria-label="Permalink to “架构”">​</a></h3><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Mac (Surge)  →  云服务器 (WireGuard Relay)  →  UniFi 内网 (WireGuard Server)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="实现方式" tabindex="-1">实现方式 <a class="header-anchor" href="#实现方式" aria-label="Permalink to “实现方式”">​</a></h3><p>在云端服务器上安装WireGuard</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sudo apt update &amp;&amp; sudo apt install wireguard -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>配置云服务器上的wg0.conf</li></ol><div class="language-ini line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Interface]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 10.0.0.1/24</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ListenPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 51820</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PrivateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;云服务器的私钥&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Peer]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PublicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;UniFi WireGuard 服务器的公钥&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AllowedIPs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 0.0.0.0/0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;UniFi 内网 WireGuard 服务器的 IP&gt;:51820</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PersistentKeepalive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 25</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="3"><li>内网 WireGuard 服务器上，配置 wg0.conf</li></ol><div class="language-ini line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Interface]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 10.0.0.2/24</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ListenPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 51820</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PrivateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;UniFi WireGuard 服务器的私钥&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Peer]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PublicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;云服务器的公钥&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AllowedIPs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 0.0.0.0/0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;云服务器公网 IP&gt;:51820</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PersistentKeepalive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 25</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>在 Mac (Surge) 客户端连接云服务器</li></ol><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>[Interface]</span></span>
<span class="line"><span>PrivateKey = &lt;Mac 客户端私钥&gt;</span></span>
<span class="line"><span>Address = 10.0.0.3/24</span></span>
<span class="line"><span>DNS = 8.8.8.8</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Peer]</span></span>
<span class="line"><span>PublicKey = &lt;云服务器的公钥&gt;</span></span>
<span class="line"><span>AllowedIPs = 0.0.0.0/0</span></span>
<span class="line"><span>Endpoint = &lt;云服务器公网 IP&gt;:51820</span></span>
<span class="line"><span>PersistentKeepalive = 25</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">✅ 优点</p><p>稳定，流量由云服务器中转，不受 NAT 限制。<br> 适用于任何网络，不会被运营商 NAT 限制。<br> 支持 Surge，Mac 端可以直接配置 WireGuard 连接云服务器。</p></div><div class="tip custom-block"><p class="custom-block-title">❌ 缺点</p><p>需要云服务器（但可以选择最便宜的实例）。<br> 增加一点延迟，因为流量要经过云服务器转发。</p></div><h2 id="安装wireguard" tabindex="-1">安装WireGuard <a class="header-anchor" href="#安装wireguard" aria-label="Permalink to “安装WireGuard”">​</a></h2><blockquote><p>需要内核版本: Linux 内核 5.6+<br> 查看内核版本: uname -r</p></blockquote><h3 id="安装wireguard-1" tabindex="-1">安装WireGuard <a class="header-anchor" href="#安装wireguard-1" aria-label="Permalink to “安装WireGuard”">​</a></h3><p>在 CentOS 9，WireGuard 相关软件包已包含在默认 AppStream 仓库，可直接安装：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sudo dnf install -y wireguard-tools</span></span>
<span class="line"><span>wg --version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="配置-wireguard" tabindex="-1">配置 WireGuard <a class="header-anchor" href="#配置-wireguard" aria-label="Permalink to “配置 WireGuard”">​</a></h3><p>(1) 生成密钥对</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>wg genkey | tee privatekey | wg pubkey &gt; publickey</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这会生成两个文件：<br> • privatekey：服务器的私钥。<br> • publickey：服务器的公钥。</p><p>(2) 创建 WireGuard 配置</p><p>编辑 /etc/wireguard/wg0.conf：</p><div class="language-ini line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Interface]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PrivateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;你的私钥&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 10.0.0.1/24</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ListenPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 51820</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[Peer]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PublicKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;客户端公钥&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AllowedIPs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 10.0.0.2/32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = &lt;客户端公网IP&gt;:51820</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PersistentKeepalive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 25</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>(3) 启用 WireGuard</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sudo systemctl enable --now wg-quick@wg0</span></span>
<span class="line"><span>sudo systemctl status wg-quick@wg0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="开放防火墙端口" tabindex="-1">开放防火墙端口 <a class="header-anchor" href="#开放防火墙端口" aria-label="Permalink to “开放防火墙端口”">​</a></h3><p>CentOS 9 使用 firewalld，你需要允许 WireGuard 的 UDP 端口：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sudo firewall-cmd --permanent --add-port=51820/udp</span></span>
<span class="line"><span>sudo firewall-cmd --reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="启用-ip-转发-如果需要" tabindex="-1">启用 IP 转发（如果需要） <a class="header-anchor" href="#启用-ip-转发-如果需要" aria-label="Permalink to “启用 IP 转发（如果需要）”">​</a></h3><p>如果你要让客户端通过 WireGuard 访问其他网络，需要开启 IP 转发：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>echo &quot;net.ipv4.ip_forward = 1&quot; | sudo tee -a /etc/sysctl.conf</span></span>
<span class="line"><span>sudo sysctl -p</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="启动和管理-wireguard-服务" tabindex="-1">启动和管理 WireGuard 服务 <a class="header-anchor" href="#启动和管理-wireguard-服务" aria-label="Permalink to “启动和管理 WireGuard 服务”">​</a></h3><p>(1) 使用 wg-quick 启动 WireGuard：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sudo wg-quick up wg0</span></span>
<span class="line"><span>sudo wg # 检查WireGuard状态</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>(2) 使WireGuard开机自启动 通过 systemd 设置 WireGuard 服务为开机自启：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sudo systemctl enable wg-quick@wg0</span></span>
<span class="line"><span></span></span>
<span class="line"><span>sudo systemctl start wg-quick@wg0 # 启动</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div>`,42)]))}const u=a(l,[["render",p]]);export{b as __pageData,u as default};
